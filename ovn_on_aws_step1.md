# AWS上でOpenVNetを使ってみる - Step1

## 構成イメージ

下図に示す構成を作成する。
![OVSを使ったネットワーク構成](http://bl.ocks.org/mao172/raw/b6660f9cb1b73a0b600d/network_02.png)

## EC2インスタンスの準備

1. セキュリティグループの作成
  - インバウンドを次のように設定する。
    - カスタムプロトコル: 47 : すべて
    - SSH : TCP : 22
    - すべてのICMP : すべて : 該当なし
    ![セキュリティグループの設定](http://bl.ocks.org/mao172/raw/b6660f9cb1b73a0b600d/security_group_01.png)
1. OpenVNetを稼動させるsv0と、接続ノードになるsv1、sv2を作成する。
  - OpenVNetの動作環境がCentOSなので、「AWS Marketplace」から'CentOS 6 (x86_64) - with Updates'を選択してイメージを作成する。
  - インスタンスの詳細の設定でsv0、sv1、sv2が同じサブネットになるように設定する。
  - セキュリティグループの設定でsv0、sv1、sv2に先に作成したセキュリティグループを割り当てる。
  - NICを最初から2つに設定して作成すると、パブリックIPが割り当てられなくなるためNIC1つ(eth0のみ)で構成し、後から追加する。
2. 「ソース/宛先チェックの無効化」を無効に設定する。
  - EC2のインスタンスを選択し、[アクション]-[ネットワーキング]-[送信元/送信先の変更チェック]を選択する。
3. ネットワークインタフェースを作成し、各インスタンスにアタッチする。（eth1を追加する）
  - eth0とは異なるサブネットになるように設定する。
  - アベイラビリティゾーンはeth0と同じになるように設定する。
  - 先に作成したセキュリティグループを割り当てる。
  - 「送信元/送信先の変更チェック」を無効にする。
    - 作成したネットワークインタフェースを選択し、[アクション]-[送信元/送信先の変更チェック]を選択する。


## eth1の設定
  各EC2インスタンスにログインし、`create_eth1.sh`を実行する
  ```
  $ sh ./create_eth1.sh
  ```
